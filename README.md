# LPC810マイコン用システムクロック設定プログラム

## 概要

このプログラムは、NXPセミコンダクターズ社のARMベースマイコンである**LPC810**に搭載することを目的としたプログラムである。

該当マイコンの動作クロックの選択と、ウォッチドッグタイマの設定を、マイコンのユーザーズマニュアルを読まなくとも、容易に指定できることを目的としている。

現版ではLPC810マイコン限定としているが、LPC800シリーズマイコンのLPC811やLPC812でも動作可能に作っている。   
外部に接続した水晶発振子での動作(LPC811、及びLPC812のみ可能)はサポートしてないのでLPC810限定としている。

## 機能

LPC800シリーズマイコンの開発環境として、NXPセミコンダクターズ社提供のLPCXpressoがあるが、本プログラムは、それに付属するCMSISライブラリ(CMSIS_CORE_LPC8xx)内のsystem_LPC8xx.cを置き換えるものである。

従来のsystem_LPC8xx.cと比較して、以下の点を改善している。

* 最初にウォッチドッグタイマ(WDT)を開始し、すべてのコードをWDTで保護するようにしている。
* データシートを見なくとも動作クロックの選択をできるようにした。
* 同様に、WDTタイムアウト時間の設定も容易にできるようにした。
* クロック選択で内蔵オシレータを使わない場合は、内蔵オシレータの電源を切ることができる。
* システムクロックを示す外部変数SystemCoreClockを、起動時に初期化するようにした。これにより、わざわざSystemCoreClockUpdate()を呼び出す必要はなくなった(本関数はダミーとして残してある)。  
なお、この変更に伴いSystemCoreClockの静的な初期化は必要なくなったためしてない。
* WDT用オシレータのクロック周波数を、ユーザーズマニュアル(UM10601)の値に合わせた。
* IOCONやUSART/UARTの伝送速度設定用にメインクロックの値も取得できるようにした。
* 細かい改善点として、オリジナルコードではコード中にマジックナンバーが直接記述されていたが、これらを全てシンボル定義し、可読性の向上を図っている。


本プログラムは、LPCXpresso Ver.6.1.0で動作確認している。  

## 使用方法

* LPCXpressoでライブラリを使用しないプロジェクトを作る。ただし、CMSIS_CORE_LPC8xxのヘッダファイルは使用するので、ビルド時のインクルードパスに、それらヘッダファイルのありかを追加しておく。(もう少し詳しく知りたい場合は[こちら](http://tmblr.co/ZxYHSo1I6pJUN)を参照して頂きたい。)

* プロジェクトを作った時に自動生成される以下のファイルは、そのまま使用する。なお、**自動生成されたmain.cは使用しない**。
	+ cr_startup_lpc8xx.c
	+ crp.c
	+ mtb.c

* 本リポジトリに含まれるファイルを、プロジェクトのsrcフォルダとincフォルダ内に追加する。incフォルダを作らない設定にしていた場合は、すべてsrcフォルダ内に入れてしまっても構わない。

* ビルドして、できあがったHEXファイルをLPC810マイコンに書き込む。この手順は通常通りである。

* プログラムの詳細な動作に関してはmain.c先頭のコメントを参照のこと。main.cが動作確認用のサンプルプログラムである。

## 免責事項

このプログラムは誰でも自由に無償で使ってもらって構わない。ただし、使用した場合は、その旨を分かるように記載しておいて欲しい。  
また、筆者はこのプログラムに関して、いかなる責任も負わない。  
より詳しくは、同梱のLICENSEを参照のこと。